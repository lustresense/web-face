#USER
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RS Lorem Ipsum - Pelayanan Pasien</title>
    <!-- Muat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Konfigurasi warna branding "cyan agak keijoan" (Teal)
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': {
                            100: '#ccfbf1', // teal-100
                            500: '#14b8a6', // teal-500
                            600: '#0d9488', // teal-600
                            700: '#0f766e', // teal-700
                            900: '#134e4a', // teal-900
                        },
                    }
                }
            }
        }
    </script>
    <style>
        /* Muat Font Inter */
        html {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        .hidden { display: none; }

        /* Styling untuk Navigasi Aktif */
        .nav-button.active {
            border-bottom-color: #0d9488; /* primary-600 */
            color: #0d9488; /* primary-600 */
            font-weight: 700;
        }
        
        /* Animasi fade-in sederhana */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 antialiased">

    <!-- ===== HEADER / NAVIGASI ===== -->
    <header class="bg-white shadow-md sticky top-0 z-40">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Brand Logo (Tombol Home) -->
                <div id="nav-home" class="text-xl font-bold text-gray-800 cursor-pointer hover:text-primary-600 transition-colors flex items-center gap-2">
                    <svg class="h-6 w-6 text-primary-600" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
                    </svg>
                    RS Lorem Ipsum
                </div>
                <!-- Navigasi Utama (Tanpa Admin) -->
                <div id="main-nav-links" class="flex space-x-4">
                    <button id="nav-registrasi" class="nav-button font-medium text-gray-600 hover:text-primary-600 px-3 py-2 border-b-2 border-transparent transition-all">
                        Registrasi
                    </button>
                    <button id="nav-poli" class="nav-button font-medium text-gray-600 hover:text-primary-600 px-3 py-2 border-b-2 border-transparent transition-all">
                        Poli Tujuan
                    </button>
                    <!-- Link Admin Dihapus -->
                </div>
            </div>
        </nav>
    </header>

    <!-- ===== KONTEN UTAMA ===== -->
    <main class="container mx-auto p-4 sm:p-6 lg:p-8">

        <!-- ===== HALAMAN 0: HOME (Default) ===== -->
        <section id="page-home" class="animate-fade-in">
            <!-- Hero Section Sambutan -->
            <div class="bg-gradient-to-r from-primary-700 to-primary-600 rounded-xl shadow-xl text-white p-10 md:p-16 text-center overflow-hidden">
                <h1 class="text-4xl md:text-5xl font-extrabold mb-4">Selamat Datang di RS Lorem Ipsum</h1>
                <p class="text-lg md:text-xl text-primary-100 mb-10 max-w-3xl mx-auto">
                    Pelayanan kesehatan terpadu, profesional, dan ramah untuk Anda dan keluarga. Silakan pilih layanan yang Anda butuhkan di bawah ini.
                </p>
                <div class="flex flex-col sm:flex-row gap-6 justify-center">
                    <button id="btn-home-registrasi" class="px-8 py-4 bg-white text-primary-700 font-bold rounded-lg shadow-lg hover:bg-gray-100 transition-transform transform hover:scale-105">
                        Registrasi Pasien Baru
                    </button>
                    <button id="btn-home-ke-poli" class="px-8 py-4 bg-black bg-opacity-25 text-white font-bold rounded-lg hover:bg-opacity-30 transition-transform transform hover:scale-105">
                        Poli Tujuan / Verifikasi
                    </button>
                </div>
            </div>
        </section>

        <!-- ===== HALAMAN 1: REGISTRASI ===== -->
        <section id="page-registrasi" class="hidden animate-fade-in">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Registrasi Pasien Baru</h1>
            <!-- Layout responsif "Jatuh Alfabet" (flex-col md:flex-row) -->
            <div class="flex flex-col md:flex-row gap-6">
                
                <!-- Kolom Kiri: Form Input -->
                <div class="w-full md:w-1/2 bg-white p-6 rounded-xl shadow-lg">
                    <form id="form-registrasi" class="space-y-5">
                        <h2 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">Formulir Data Diri</h2>
                        <div>
                            <label for="reg-nik" class="block text-sm font-medium text-gray-700">NIK</label>
                            <input type="text" id="reg-nik" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600" placeholder="Masukkan 16 digit NIK" required>
                        </div>
                        <div>
                            <label for="reg-nama" class="block text-sm font-medium text-gray-700">Nama Lengkap</label>
                            <input type="text" id="reg-nama" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600" placeholder="Sesuai KTP" required>
                        </div>
                        <div>
                            <label for="reg-ttl" class="block text-sm font-medium text-gray-700">Tanggal Lahir</label>
                            <input type="date" id="reg-ttl" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600" required>
                        </div>
                        <div>
                            <label for="reg-alamat" class="block text-sm font-medium text-gray-700">Alamat</label>
                            <textarea id="reg-alamat" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600" placeholder="Alamat lengkap domisili" required></textarea>
                        </div>
                        <button type="submit" id="btn-mulai-regis" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-base font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-600">
                            Mulai Registrasi
                        </button>
                    </form>
                </div>

                <!-- Kolom Kanan: Placeholder Webcam -->
                <div class="w-full md:w-1/2 bg-gray-700 rounded-xl shadow-lg flex items-center justify-center min-h-[400px] md:min-h-0">
                    <div class="text-center text-gray-400">
                         <svg class="mx-auto h-24 w-24" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.82 47.82 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.773 48.773 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.04l-.821 1.316Z" /></svg>
                        <p class="text-2xl font-medium mt-4">Area Pindai Wajah</p>
                        <p class="text-sm">(Simulasi Pengambilan 20 Gambar)</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ===== HALAMAN 2: POLI TUJUAN (VERIFIKASI) ===== -->
        <section id="page-poli" class="hidden animate-fade-in">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Poli Tujuan & Verifikasi</h1>
            <div class="flex flex-col items-center gap-6">
                <!-- Placeholder Webcam -->
                <div class="w-full max-w-3xl bg-gray-700 rounded-xl shadow-lg flex items-center justify-center aspect-video">
                    <p class="text-2xl font-medium text-gray-400">Area Pindai Wajah Poli</p>
                </div>
                <!-- Kontrol Scan -->
                <div class="bg-white p-6 rounded-xl shadow-lg w-full max-w-3xl">
                    <div id="scan-normal-view">
                        <button id="btn-scan" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-base font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-600">
                            Pindai Wajah
                        </button>
                        <button id="btn-kendala" class="w-full text-center text-sm font-medium text-gray-600 hover:text-primary-600 mt-4">
                            Ada Kendala Wajah? (Verifikasi Manual)
                        </button>
                    </div>
                    <div id="scan-nik-view" class="hidden space-y-4">
                        <h3 class="text-lg font-medium text-gray-800">Verifikasi Manual</h3>
                        <label for="scan-nik-input" class="block text-sm font-medium text-gray-700">Cari dengan NIK</label>
                        <input type="text" id="scan-nik-input" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600" placeholder="Masukkan NIK terdaftar...">
                        <button id="btn-cari-nik" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-lg shadow-sm text-base font-medium text-white bg-gray-600 hover:bg-gray-700">
                            Cari Data
                        </button>
                        <button id="btn-kembali-scan" class="w-full text-center text-sm font-medium text-gray-600 hover:text-primary-600 mt-2">
                            Kembali ke Pindai Wajah
                        </button>
                    </div>
                    <div id="scan-result-view" class="hidden mt-6 text-center">
                        <p class="text-gray-600">Nama Terdeteksi:</p>
                        <h2 id="result-nama" class="text-3xl font-bold text-gray-900">...</h2>
                        <button id="btn-detail-data" class="mt-4 py-2 px-6 border border-transparent rounded-lg shadow-sm text-base font-medium text-white bg-gray-800 hover:bg-gray-900">
                            Tampilkan Detail Data
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- ===== HALAMAN 3: POLI GATEWAY (Input Keluhan - Data Detail.png) ===== -->
        <section id="page-poli-gateway" class="hidden animate-fade-in">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Formulir Kunjungan Poli</h1>
            <div class="w-full max-w-2xl mx-auto bg-white p-6 rounded-xl shadow-lg">
                <form id="form-poli-gateway">
                    <!-- Bagian Auto Sesuai Wireframe -->
                    <fieldset class="mb-6">
                        <legend class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">Data Pasien (Otomatis)</legend>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-500">Nama</label>
                                <p id="gateway-nama" class="text-lg font-medium text-gray-900"></p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-500">Umur</label>
                                <p id="gateway-umur" class="text-lg font-medium text-gray-900"></p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-500">Alamat</label>
                                <p id="gateway-alamat" class="text-lg font-medium text-gray-900"></p>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Bagian Isi Manual Sesuai Wireframe -->
                    <fieldset>
                        <legend class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">Pemeriksaan Awal (Manual)</legend>
                        <div class="space-y-4">
                            <!-- (PERUBAHAN) Pilih Poli dipindah ke sini -->
                            <div>
                                <label for="gateway-poli" class="block text-sm font-medium text-gray-700">Pilih Poli Tujuan</label>
                                <select id="gateway-poli" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600" required>
                                    <option value="" disabled selected>-- Pilih Poli Kunjungan --</option>
                                    <option value="Poli Umum">Poli Umum</option>
                                    <option value="Poli Gigi">Poli Gigi</option>
                                    <option value="IGD">IGD</option>
                                </select>
                            </div>
                            <div>
                                <label for="gateway-keluhan" class="block text-sm font-medium text-gray-700">Keluhan</label>
                                <textarea id="gateway-keluhan" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600" placeholder="Misal: Demam, pusing" required></textarea>
                            </div>
                            <div>
                                <label for="gateway-sejak" class="block text-sm font-medium text-gray-700">Sejak Kapan</label>
                                <input type="text" id="gateway-sejak" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600" placeholder="Misal: 3 hari yang lalu" required>
                            </div>
                            <div class="flex flex-col sm:flex-row gap-4">
                                <div class="w-full sm:w-1/2">
                                    <label for="gateway-tb" class="block text-sm font-medium text-gray-700">Tinggi Badan (cm)</label>
                                    <input type="number" id="gateway-tb" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600" placeholder="Contoh: 170" required>
                                </div>
                                <div class="w-full sm:w-1/2">
                                    <label for="gateway-bb" class="block text-sm font-medium text-gray-700">Berat Badan (kg)</label>
                                    <input type="number" id="gateway-bb" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600" placeholder="Contoh: 65" required>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <button type="submit" id="btn-gateway-submit" class="mt-8 w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-base font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-600">
                        Dapatkan Nomor Antrian
                    </button>
                </form>
            </div>
        </section>

    </main>

    <!-- ===== KUMPULAN MODAL (POPUP) ===== -->

    <!-- Modal 1: Registrasi Sukses -->
    <div id="modal-regis-success" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6 text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100">
                <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mt-4">Registrasi Berhasil!</h3>
            <p class="mt-2 text-gray-600">Data Anda telah berhasil disimpan. Silakan lanjut untuk melengkapi data kunjungan poli.</p>
            <div class="mt-6 flex flex-col sm:flex-row sm:space-x-4 space-y-3 sm:space-y-0">
                <button id="btn-modal-lanjut-poli" class="w-full px-4 py-2 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 focus:outline-none">
                    Lanjut ke Formulir
                </button>
                <button id="btn-modal-regis-tutup" class="w-full px-4 py-2 bg-gray-200 text-gray-800 rounded-lg font-medium hover:bg-gray-300 focus:outline-none">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <!-- Modal 2: Detail Data Poli (Hasil Scan/Cari NIK) -->
    <div id="modal-poli-detail" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-6">
            <div class="flex justify-between items-center">
                <h3 class="text-2xl font-bold text-gray-900">Detail Data Pasien</h3>
                <button id="btn-modal-poli-tutup-X" class="text-2xl text-gray-400 hover:text-gray-600">&times;</button>
            </div>
            
            <!-- Konten Detail Pasien -->
            <div id="detail-pasien-content" class="mt-4 space-y-3 text-gray-700 text-base border-t border-b border-gray-200 py-4">
                <!-- Data akan diisi oleh JavaScript -->
            </div>
            
            <!-- (PERUBAHAN) Pilih Poli Dihapus dari Sini -->

            <div class="mt-6 flex flex-col sm:flex-row sm:space-x-4 space-y-3 sm:space-y-0">
                <button id="btn-modal-poli-lanjut-pg" class="w-full px-4 py-2 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 focus:outline-none">
                    Lanjut ke Formulir
                </button>
                <button id="btn-modal-poli-tutup" class="w-full px-4 py-2 bg-gray-200 text-gray-800 rounded-lg font-medium hover:bg-gray-300 focus:outline-none">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <!-- Modal 3: Nomor Antrian -->
    <div id="modal-antrian" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-8 text-center">
            <h3 class="text-xl font-medium text-gray-800">Nomor Antrian Anda:</h3>
            <p id="antrian-poli" class="text-lg font-semibold text-primary-600 mt-1"></p>
            <p id="antrian-nomor" class="text-8xl font-bold text-gray-900 my-4">...</p>
            <p class="text-gray-600">Silakan tunggu di depan ruang poli.</p>
            <button id="btn-modal-antrian-tutup" class="mt-6 w-full px-4 py-2 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 focus:outline-none">
                OK
            </button>
        </div>
    </div>
    
    <!-- Modal 4: Loading (Spinner) -->
    <div id="modal-loading" class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
         <div class="bg-white rounded-xl shadow-2xl w-full max-w-xs p-8 text-center flex items-center gap-4">
            <svg class="animate-spin h-8 w-8 text-primary-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span class="text-xl font-medium text-gray-800">Memproses...</span>
        </div>
    </div>
    
    <!-- Modal 5: Alert / Notifikasi Sederhana -->
    <div id="modal-alert" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 text-center">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Informasi</h3>
            <p id="alert-message" class="text-gray-600 mb-6">Pesan notifikasi.</p>
            <button id="btn-modal-alert-ok" class="w-full px-4 py-2 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 focus:outline-none">
                OK
            </button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // ===== KUMPULAN ELEMEN =====
            const pageHome = document.getElementById('page-home');
            const pageRegistrasi = document.getElementById('page-registrasi');
            const pagePoli = document.getElementById('page-poli');
            const pagePoliGateway = document.getElementById('page-poli-gateway'); // Halaman baru

            const navHome = document.getElementById('nav-home');
            const mainNavLinks = document.getElementById('main-nav-links');
            const navRegistrasi = document.getElementById('nav-registrasi');
            const navPoli = document.getElementById('nav-poli');
            
            const btnHomeRegistrasi = document.getElementById('btn-home-registrasi');
            const btnHomeKePoli = document.getElementById('btn-home-ke-poli');

            // Form Registrasi
            const formRegistrasi = document.getElementById('form-registrasi');
            const inputNik = document.getElementById('reg-nik');
            const inputNama = document.getElementById('reg-nama');
            const inputTtl = document.getElementById('reg-ttl');
            const inputAlamat = document.getElementById('reg-alamat');

            // Halaman Poli (Verifikasi)
            const scanNormalView = document.getElementById('scan-normal-view');
            const scanNikView = document.getElementById('scan-nik-view');
            const scanResultView = document.getElementById('scan-result-view');
            const btnKendala = document.getElementById('btn-kendala');
            const btnKembaliScan = document.getElementById('btn-kembali-scan');
            const btnScan = document.getElementById('btn-scan');
            const btnCariNik = document.getElementById('btn-cari-nik');
            const inputScanNik = document.getElementById('scan-nik-input');
            const resultNama = document.getElementById('result-nama');
            const btnDetailData = document.getElementById('btn-detail-data');

            // Halaman Poli Gateway
            const pgNama = document.getElementById('gateway-nama');
            const pgUmur = document.getElementById('gateway-umur');
            const pgAlamat = document.getElementById('gateway-alamat');
            const formPoliGateway = document.getElementById('form-poli-gateway');
            const inputGatewayPoli = document.getElementById('gateway-poli'); // (BARU) Select Poli di form
            const inputKeluhan = document.getElementById('gateway-keluhan');
            const inputSejakKapan = document.getElementById('gateway-sejak');
            const inputTb = document.getElementById('gateway-tb');
            const inputBb = document.getElementById('gateway-bb');

            // Modals
            const modalRegisSuccess = document.getElementById('modal-regis-success');
            const modalPoliDetail = document.getElementById('modal-poli-detail');
            const modalAntrian = document.getElementById('modal-antrian');
            const modalLoading = document.getElementById('modal-loading');
            const modalAlert = document.getElementById('modal-alert');
            const alertMessage = document.getElementById('alert-message');

            // Tombol Modal
            const btnModalLanjutPoli = document.getElementById('btn-modal-lanjut-poli');
            const btnModalRegisTutup = document.getElementById('btn-modal-regis-tutup');
            const btnModalPoliLanjutPg = document.getElementById('btn-modal-poli-lanjut-pg');
            const btnModalPoliTutup = document.getElementById('btn-modal-poli-tutup');
            const btnModalPoliTutupX = document.getElementById('btn-modal-poli-tutup-X');
            const btnModalAntrianTutup = document.getElementById('btn-modal-antrian-tutup');
            const btnModalAlertOk = document.getElementById('btn-modal-alert-ok');

            // Kunci LocalStorage
            const DB_PASIEN_KEY = 'rs_pasien_db_v2';
            const DB_ANTRIAN_KEY = 'rs_antrian_counters_v2';

            // Variabel state
            let antrianCounter = JSON.parse(localStorage.getItem(DB_ANTRIAN_KEY)) || {
                "Poli Umum": 1, "Poli Gigi": 1, "IGD": 1,
            };
            let pasienAktif = null; // Simpan data pasien yg baru regis/scan

            // ===== FUNGSI DATABASE (LocalStorage) =====

            function getDbPasien() {
                const dbString = localStorage.getItem(DB_PASIEN_KEY);
                return dbString ? JSON.parse(dbString) : {};
            }
            function saveDbPasien(db) {
                localStorage.setItem(DB_PASIEN_KEY, JSON.stringify(db));
            }
            function getPasienByNik(nik) {
                const db = getDbPasien();
                return db[nik] || null;
            }
            function savePasien(data) {
                const db = getDbPasien();
                db[data.nik] = data;
                saveDbPasien(db);
            }
            function getAntrianCounters() {
                return JSON.parse(localStorage.getItem(DB_ANTRIAN_KEY)) || { "Poli Umum": 1, "Poli Gigi": 1, "IGD": 1 };
            }
            function saveAntrianCounters(counters) {
                localStorage.setItem(DB_ANTRIAN_KEY, JSON.stringify(counters));
            }

            // ===== FUNGSI UTILITAS =====

            /** Tampilkan Halaman (Page) */
            function showPage(pageId) {
                pageHome.classList.add('hidden');
                pageRegistrasi.classList.add('hidden');
                pagePoli.classList.add('hidden');
                pagePoliGateway.classList.add('hidden');
                
                document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));

                if (pageId === 'page-home') {
                    pageHome.classList.remove('hidden');
                } else if (pageId === 'page-registrasi') {
                    pageRegistrasi.classList.remove('hidden');
                    navRegistrasi.classList.add('active');
                    formRegistrasi.reset();
                } else if (pageId === 'page-poli') {
                    pagePoli.classList.remove('hidden');
                    navPoli.classList.add('active');
                    scanNormalView.classList.remove('hidden');
                    scanNikView.classList.add('hidden');
                    scanResultView.classList.add('hidden');
                    resultNama.textContent = "...";
                    inputScanNik.value = '';
                    pasienAktif = null;
                } else if (pageId === 'page-poli-gateway') {
                    pagePoliGateway.classList.remove('hidden');
                    navPoli.classList.add('active');
                }
            }

            function showModal(modal) { modal.classList.remove('hidden'); }
            function hideModal(modal) { modal.classList.add('hidden'); }
            function showAlert(message) {
                alertMessage.textContent = message;
                showModal(modalAlert);
            }

            function calculateAge(tanggalLahirStr) {
                if (!tanggalLahirStr) return 'N/A';
                try {
                    const birthDate = new Date(tanggalLahirStr);
                    const today = new Date();
                    let age = today.getFullYear() - birthDate.getFullYear();
                    const m = today.getMonth() - birthDate.getMonth();
                    if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                        age--;
                    }
                    return `${age} Tahun`;
                } catch (e) {
                    return 'N/A';
                }
            }
            
            function tampilkanNomorAntrian(poliTujuan) {
                let antrianCounters = getAntrianCounters();
                if (!antrianCounters[poliTujuan]) {
                    antrianCounters[poliTujuan] = 1; // Inisialisasi jika poli baru
                }
                const nomor = antrianCounters[poliTujuan];
                antrianCounters[poliTujuan]++;
                saveAntrianCounters(antrianCounters);

                document.getElementById('antrian-poli').textContent = `Poli: ${poliTujuan}`;
                document.getElementById('antrian-nomor').textContent = nomor;
                showModal(modalAntrian);
            }
            
            // (PERUBAHAN) Fungsi ini hanya mengisi data, tidak memilih poli
            function showPoliGateway(data) {
                showPage('page-poli-gateway');
                pgNama.textContent = data.nama;
                pgUmur.textContent = calculateAge(data.ttl);
                pgAlamat.textContent = data.alamat;
                formPoliGateway.reset(); // Kosongkan isian manual
            }

            // ===== ALUR LOGIKA APLIKASI =====

            // 1. Alur Registrasi
            formRegistrasi.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const data = {
                    nik: inputNik.value,
                    nama: inputNama.value,
                    ttl: inputTtl.value,
                    alamat: inputAlamat.value,
                    registrasi_at: new Date().toISOString()
                };
                
                if(getPasienByNik(data.nik)) {
                    showAlert("NIK ini sudah terdaftar. Silakan langsung ke Poli Tujuan.");
                    return;
                }

                savePasien(data);
                pasienAktif = data;

                showModal(modalRegisSuccess);
            });

            // 2. Alur "Lanjut ke Formulir" dari Modal Registrasi Sukses (REVISI)
            btnModalLanjutPoli.addEventListener('click', () => {
                hideModal(modalRegisSuccess);
                if (pasienAktif) {
                    showPoliGateway(pasienAktif); // Langsung ke Formulir
                } else {
                    showAlert("Terjadi kesalahan data. Silakan coba lagi.");
                    showPage('page-home');
                }
            });

            // 3. Alur "Pindai Wajah" di Halaman Poli Tujuan
            btnScan.addEventListener('click', () => {
                showModal(modalLoading);
                
                setTimeout(() => {
                    hideModal(modalLoading);
                    const db = getDbPasien();
                    const allNiks = Object.keys(db);
                    if (allNiks.length > 0) {
                        const randomNik = allNiks[Math.floor(Math.random() * allNiks.length)];
                        pasienAktif = db[randomNik]; 
                        scanResultView.classList.remove('hidden');
                        resultNama.textContent = pasienAktif.nama;
                    } else {
                        scanResultView.classList.remove('hidden');
                        resultNama.textContent = "Pasien Tidak Dikenali";
                        showAlert("Wajah tidak dikenali atau belum terdaftar. Silakan registrasi.");
                        pasienAktif = null;
                    }
                }, 1500);
            });

            // 4. Alur "Lihat Detail" dari Hasil Scan/Cari NIK
            btnDetailData.addEventListener('click', () => {
                if (!pasienAktif) {
                    showAlert("Tidak ada data pasien untuk ditampilkan.");
                    return; 
                }

                const umur = calculateAge(pasienAktif.ttl);
                const content = `
                    <p><strong>NIK:</strong> <span class="font-mono">${pasienAktif.nik}</span></p>
                    <p><strong>Nama:</strong> ${pasienAktif.nama}</p>
                    <p><strong>Tanggal Lahir:</strong> ${pasienAktif.ttl}</p>
                    <p><strong>Umur:</strong> ${umur}</p>
                    <p><strong>Alamat:</strong> ${pasienAktif.alamat}</p>
                `;
                document.getElementById('detail-pasien-content').innerHTML = content;
                showModal(modalPoliDetail);
            });
            
            // 5. Alur "Lanjut ke Formulir" dari Modal Detail (REVISI)
            btnModalPoliLanjutPg.addEventListener('click', () => {
                 if (!pasienAktif) {
                    showAlert("Terjadi kesalahan, data pasien tidak ditemukan.");
                    return;
                 }
                 hideModal(modalPoliDetail);
                 showPoliGateway(pasienAktif); // Langsung ke formulir
            });

            // 6. Alur Submit Formulir Poli Gateway (Input Keluhan) (REVISI)
            formPoliGateway.addEventListener('submit', (e) => {
                e.preventDefault();
                const poliTujuan = inputGatewayPoli.value; // (BARU) Ambil poli dari form
                
                if (!poliTujuan) {
                    showAlert("Silakan pilih poli tujuan terlebih dahulu.");
                    return;
                }
                if (!pasienAktif) {
                    showAlert("Data pasien tidak valid untuk pengajuan kunjungan.");
                    return;
                }
                
                console.log("Kunjungan Dibuat:", {
                    nik: pasienAktif.nik,
                    poli: poliTujuan, // Gunakan poli dari form
                    keluhan: inputKeluhan.value,
                    sejak: inputSejakKapan.value,
                    tb: inputTb.value,
                    bb: inputBb.value
                });
                
                tampilkanNomorAntrian(poliTujuan); // Tampilkan antrian
                
                formPoliGateway.reset();
                pasienAktif = null;
            });


            // 7. Alur "Kendala Wajah?" (Fallback NIK)
            btnKendala.addEventListener('click', () => {
                scanNormalView.classList.add('hidden');
                scanResultView.classList.add('hidden');
                scanNikView.classList.remove('hidden');
            });

            btnKembaliScan.addEventListener('click', () => {
                scanNormalView.classList.remove('hidden');
                scanNikView.classList.add('hidden');
                scanResultView.classList.add('hidden');
                resultNama.textContent = "...";
                inputScanNik.value = '';
                pasienAktif = null;
            });
            
            btnCariNik.addEventListener('click', () => {
                const nik = inputScanNik.value;
                if (!nik) {
                    showAlert("Mohon masukkan NIK untuk mencari.");
                    return;
                }
                const pasien = getPasienByNik(nik);
                
                if (pasien) {
                    pasienAktif = pasien;
                    scanResultView.classList.remove('hidden');
                    resultNama.textContent = pasien.nama;
                    inputScanNik.value = '';
                } else {
                    scanResultView.classList.remove('hidden');
                    resultNama.textContent = "NIK Tidak Ditemukan";
                    showAlert("NIK yang Anda masukkan tidak terdaftar.");
                    pasienAktif = null;
                }
            });

            // ===== EVENT LISTENER LAINNYA (Nav & Tutup Modal) =====
            navHome.addEventListener('click', () => showPage('page-home'));
            navRegistrasi.addEventListener('click', () => showPage('page-registrasi'));
            navPoli.addEventListener('click', () => showPage('page-poli'));
            
            btnHomeRegistrasi.addEventListener('click', () => showPage('page-registrasi'));
            btnHomeKePoli.addEventListener('click', () => showPage('page-poli'));

            btnModalRegisTutup.addEventListener('click', () => { hideModal(modalRegisSuccess); showPage('page-home'); });
            btnModalPoliTutup.addEventListener('click', () => hideModal(modalPoliDetail));
            btnModalPoliTutupX.addEventListener('click', () => hideModal(modalPoliDetail));
            btnModalAntrianTutup.addEventListener('click', () => { hideModal(modalAntrian); showPage('page-home'); });
            btnModalAlertOk.addEventListener('click', () => hideModal(modalAlert));

            // Inisialisasi: Tampilkan halaman Home di awal
            showPage('page-home');
        });
    </script>
</body>
</html>





#ADMIN 
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - RS Lorem Ipsum</title>
    <!-- Muat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Konfigurasi warna branding "cyan agak keijoan" (Teal)
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': {
                            100: '#ccfbf1', // teal-100
                            500: '#14b8a6', // teal-500
                            600: '#0d9488', // teal-600
                            700: '#0f766e', // teal-700
                            900: '#134e4a', // teal-900
                        },
                    }
                }
            }
        }
    </script>
    <style>
        /* Muat Font Inter */
        html {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        .hidden { display: none; }
        
        /* Gaya untuk header tabel yang bisa disortir */
        .sortable {
            cursor: pointer;
            user-select: none;
        }
        .sortable:hover {
            background-color: #f0fdfa; /* primary-100/50 */
        }
        .sortable .sort-icon {
            opacity: 0.3;
            display: inline-block;
            transition: opacity 0.2s;
        }
        .sortable.active .sort-icon {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-100 antialiased">

    <!-- ===== HALAMAN LOGIN (Default) ===== -->
    <div id="page-login" class="flex items-center justify-center min-h-screen bg-gray-200">
        <div class="w-full max-w-md bg-white p-8 rounded-xl shadow-lg">
            <div class="flex justify-center items-center mb-4">
                <svg class="h-10 w-10 text-primary-600" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
                </svg>
                <h1 class="text-3xl font-bold text-center text-primary-900 ml-2">RS Lorem Ipsum</h1>
            </div>
            <h2 class="text-xl font-semibold text-center text-gray-700 mb-6">Admin Dashboard Login</h2>
            <form id="form-login" class="space-y-5">
                <div>
                    <label for="admin-user" class="block text-sm font-medium text-gray-700">Username</label>
                    <input type="text" id="admin-user" value="admin" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600">
                </div>
                <div>
                    <label for="admin-pass" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="admin-pass" value="admin123" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600">
                </div>
                <p id="login-error" class="text-sm text-red-600 hidden">Username atau password salah.</p>
                <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-base font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-600">
                    Login
                </button>
            </form>
        </div>
    </div>

    <!-- ===== HALAMAN DASHBOARD (Setelah Login) ===== -->
    <div id="page-dashboard" class="hidden">
        <!-- Header Dashboard -->
        <header class="bg-primary-900 text-white shadow-lg">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-16">
                <h1 class="text-xl font-bold">Admin Dashboard</h1>
                <div>
                    <span class="mr-4">Selamat datang, <strong id="admin-nama">Admin</strong></span>
                    <button id="btn-logout" class="py-1 px-3 bg-red-600 hover:bg-red-700 rounded-md text-sm font-medium">Logout</button>
                </div>
            </div>
        </header>

        <!-- Konten Dashboard -->
        <main class="container mx-auto p-4 sm:p-6 lg:p-8">
            
            <!-- Kartu Statistik -->
            <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl shadow-lg flex flex-col justify-between">
                    <h3 class="text-lg font-semibold text-gray-600">Status Model AI</h3>
                    <p id="status-model" class="text-3xl font-bold text-gray-900 mt-2">Model (Simulasi)</p>
                    <p class="text-sm text-gray-500">Tersimpan & Aktif</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg flex flex-col justify-between">
                    <h3 class="text-lg font-semibold text-gray-600">Total Data Pasien</h3>
                    <p id="total-pasien" class="text-3xl font-bold text-gray-900 mt-2">0</p>
                    <p class="text-sm text-gray-500">Pasien terdaftar di sistem</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg flex flex-col justify-between">
                    <h3 class="text-lg font-semibold text-gray-600">Aksi Cepat</h3>
                    <button id="btn-retrain" class="mt-3 w-full py-3 px-4 border border-transparent rounded-lg shadow-sm text-base font-medium text-white bg-primary-600 hover:bg-primary-700">
                        Retrain Model (Simulasi)
                    </button>
                </div>
            </section>

            <!-- Manajemen Antrian (Sesuai Poli Baru) -->
            <section class="mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Manajemen Antrian</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Poli Umum -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold text-gray-900">Poli Umum</h3>
                        <p class="text-5xl font-extrabold text-primary-600 my-4" id="antrian-umum">1</p>
                        <div class="flex gap-4">
                            <button data-poli="Poli Umum" class="btn-ubah w-full py-2 px-4 rounded-lg text-sm font-medium text-white bg-yellow-500 hover:bg-yellow-600">Ubah</button>
                            <button data-poli="Poli Umum" class="btn-reset w-full py-2 px-4 rounded-lg text-sm font-medium text-white bg-red-600 hover:bg-red-700">Reset</button>
                        </div>
                    </div>
                    <!-- Poli Gigi -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold text-gray-900">Poli Gigi</h3>
                        <p class="text-5xl font-extrabold text-primary-600 my-4" id="antrian-gigi">1</p>
                        <div class="flex gap-4">
                            <button data-poli="Poli Gigi" class="btn-ubah w-full py-2 px-4 rounded-lg text-sm font-medium text-white bg-yellow-500 hover:bg-yellow-600">Ubah</button>
                            <button data-poli="Poli Gigi" class="btn-reset w-full py-2 px-4 rounded-lg text-sm font-medium text-white bg-red-600 hover:bg-red-700">Reset</button>
                        </div>
                    </div>
                    <!-- IGD -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold text-gray-900">IGD</h3>
                        <p class="text-5xl font-extrabold text-primary-600 my-4" id="antrian-igd">1</p>
                        <div class="flex gap-4">
                            <button data-poli="IGD" class="btn-ubah w-full py-2 px-4 rounded-lg text-sm font-medium text-white bg-yellow-500 hover:bg-yellow-600">Ubah</button>
                            <button data-poli="IGD" class="btn-reset w-full py-2 px-4 rounded-lg text-sm font-medium text-white bg-red-600 hover:bg-red-700">Reset</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Data Pasien Terdaftar (BARU: dengan sortir, paginasi, CRUD) -->
            <section>
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Data Pasien Terdaftar</h2>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <!-- Kontrol Tabel -->
                    <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                        <div class="flex items-center gap-2">
                            <label for="show-rows" class="text-sm font-medium text-gray-700">Tampilkan:</label>
                            <select id="show-rows" class="block w-full sm:w-auto px-3 py-1.5 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600 text-sm">
                                <option value="10" selected>10 data</option>
                                <option value="50">50 data</option>
                                <option value="999999">Tampilkan Semua</option>
                            </select>
                        </div>
                        <div class="text-sm text-gray-600">
                            <span id="page-info">Menampilkan 0-0 dari 0 data</span>
                        </div>
                    </div>
                    
                    <!-- Tabel Data -->
                    <div class="overflow-x-auto">
                        <table class="w-full min-w-max text-left">
                            <thead class="border-b bg-gray-50">
                                <tr>
                                    <th class="py-3 px-4 text-sm font-semibold text-gray-600 sortable active" data-sort="nik">NIK <span class="sort-icon">&darr;</span></th>
                                    <th class="py-3 px-4 text-sm font-semibold text-gray-600 sortable" data-sort="nama">Nama <span class="sort-icon">&uarr;&darr;</span></th>
                                    <th class="py-3 px-4 text-sm font-semibold text-gray-600 sortable" data-sort="ttl">Tgl Lahir <span class="sort-icon">&uarr;&darr;</span></th>
                                    <th class="py-3 px-4 text-sm font-semibold text-gray-600 sortable" data-sort="alamat">Alamat <span class="sort-icon">&uarr;&darr;</span></th>
                                    <th class="py-3 px-4 text-sm font-semibold text-gray-600">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="tabel-pasien-body">
                                <!-- Data dummy/dinamis diisi oleh JS -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Kontrol Paginasi -->
                    <div class="flex justify-between items-center mt-4">
                        <button id="prev-page" class="py-2 px-4 rounded-lg text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 disabled:bg-gray-400 disabled:cursor-not-allowed">
                            &larr; Sebelumnya
                        </button>
                        <span id="page-number" class="text-sm font-medium text-gray-700">Halaman 1</span>
                        <button id="next-page" class="py-2 px-4 rounded-lg text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 disabled:bg-gray-400 disabled:cursor-not-allowed">
                            Berikutnya &rarr;
                        </button>
                    </div>
                </div>
            </section>

        </main>
    </div>
    
    <!-- ===== MODAL ADMIN ===== -->
    
    <!-- Modal Konfirmasi Hapus -->
    <div id="modal-konfirmasi" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
                <svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" /></svg>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mt-4">Konfirmasi Tindakan</h3>
            <p id="konfirmasi-pesan" class="mt-2 text-gray-600">Anda yakin ingin menghapus data ini?</p>
            <div class="mt-6 flex space-x-4">
                <button id="btn-konfirmasi-batal" class="w-full px-4 py-2 bg-gray-200 text-gray-800 rounded-lg font-medium hover:bg-gray-300 focus:outline-none">
                    Batal
                </button>
                <button id="btn-konfirmasi-ya" class="w-full px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 focus:outline-none">
                    Ya, Hapus
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal Edit Pasien -->
    <div id="modal-edit-pasien" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-6">
            <h3 class="text-2xl font-bold text-gray-900 mb-6">Ubah Data Pasien</h3>
            <form id="form-edit-pasien" class="space-y-4">
                <input type="hidden" id="edit-nik-lama"> <!-- Menyimpan NIK asli untuk pencarian -->
                <div>
                    <label for="edit-nik" class="block text-sm font-medium text-gray-700">NIK</label>
                    <input type="text" id="edit-nik" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600" required>
                </div>
                <div>
                    <label for="edit-nama" class="block text-sm font-medium text-gray-700">Nama Lengkap</label>
                    <input type="text" id="edit-nama" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600" required>
                </div>
                <div>
                    <label for="edit-ttl" class="block text-sm font-medium text-gray-700">Tanggal Lahir</label>
                    <input type="date" id="edit-ttl" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600" required>
                </div>
                <div>
                    <label for="edit-alamat" class="block text-sm font-medium text-gray-700">Alamat</label>
                    <textarea id="edit-alamat" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-600 focus:border-primary-600" required></textarea>
                </div>
                <!-- Poli tidak bisa diedit di sini, hanya di form registrasi -->
                
                <div class="mt-6 flex space-x-4">
                    <button type="button" id="btn-edit-batal" class="w-full px-4 py-2 bg-gray-200 text-gray-800 rounded-lg font-medium hover:bg-gray-300 focus:outline-none">
                        Batal
                    </button>
                    <button type="submit" class="w-full px-4 py-2 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 focus:outline-none">
                        Simpan Perubahan
                    </button>
                </div>
            </form>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ===== KUNCI LOCALSTORAGE =====
            const DB_PASIEN_KEY = 'rs_pasien_db_v2'; // Cocokkan dengan User App
            const DB_ANTRIAN_KEY = 'rs_antrian_counters_v2'; // Cocokkan dengan User App
            const ADMIN_AUTH_KEY = 'rs_admin_auth_v2';

            // ===== ELEMEN LOGIN =====
            const pageLogin = document.getElementById('page-login');
            const pageDashboard = document.getElementById('page-dashboard');
            const formLogin = document.getElementById('form-login');
            const inputAdminUser = document.getElementById('admin-user');
            const inputAdminPass = document.getElementById('admin-pass');
            const loginError = document.getElementById('login-error');

            // ===== ELEMEN DASHBOARD =====
            const btnLogout = document.getElementById('btn-logout');
            const totalPasien = document.getElementById('total-pasien');
            const antrianUmum = document.getElementById('antrian-umum');
            const antrianGigi = document.getElementById('antrian-gigi');
            const antrianIgd = document.getElementById('antrian-igd');
            const tabelPasienBody = document.getElementById('tabel-pasien-body');

            // ===== ELEMEN KONTROL TABEL =====
            const showRowsSelect = document.getElementById('show-rows');
            const pageInfo = document.getElementById('page-info');
            const prevPageBtn = document.getElementById('prev-page');
            const nextPageBtn = document.getElementById('next-page');
            const pageNumber = document.getElementById('page-number');
            const sortHeaders = document.querySelectorAll('.sortable');

            // ===== ELEMEN MODAL =====
            const modalKonfirmasi = document.getElementById('modal-konfirmasi');
            const konfirmasiPesan = document.getElementById('konfirmasi-pesan');
            const btnKonfirmasiBatal = document.getElementById('btn-konfirmasi-batal');
            const btnKonfirmasiYa = document.getElementById('btn-konfirmasi-ya');
            
            const modalEditPasien = document.getElementById('modal-edit-pasien');
            const formEditPasien = document.getElementById('form-edit-pasien');
            const btnEditBatal = document.getElementById('btn-edit-batal');

            // ===== STATE TABEL (BARU) =====
            let adminState = {
                sortKey: 'nik',
                sortDir: 'asc',
                rowsPerPage: 10,
                currentPage: 1,
                dataFull: [], // Data asli dari localStorage
                dataSorted: [], // Data setelah disortir
                dataPaginated: [], // Data setelah dipaginasi
                nikUntukDihapus: null,
                nikUntukDiedit: null,
            };

            // ===== FUNGSI DATABASE (Simulasi) =====
            
            function getPasienDb() {
                const dbString = localStorage.getItem(DB_PASIEN_KEY);
                return dbString ? JSON.parse(dbString) : {};
            }
            function savePasienDb(db) {
                localStorage.setItem(DB_PASIEN_KEY, JSON.stringify(db));
            }
            function getAntrianDb() {
                const dbString = localStorage.getItem(DB_ANTRIAN_KEY);
                return dbString ? JSON.parse(dbString) : { "Poli Umum": 1, "Poli Gigi": 1, "IGD": 1 };
            }
            function saveAntrianDb(antrianData) {
                localStorage.setItem(DB_ANTRIAN_KEY, JSON.stringify(antrianData));
            }
            
            function createDummyData() {
                if (Object.keys(getPasienDb()).length > 0) return; // Jangan buat jika sudah ada data
                
                const dummies = {
                    '3201011203900001': { nik: '3201011203900001', nama: 'Budi Santoso', ttl: '1990-03-12', alamat: 'Jl. Merdeka No. 1, Jakarta', registrasi_at: new Date().toISOString() },
                    '3201011507880002': { nik: '3201011507880002', nama: 'Citra Lestari', ttl: '1988-07-15', alamat: 'Jl. Pahlawan No. 20, Surabaya', registrasi_at: new Date().toISOString() },
                    '3201010101950003': { nik: '3201010101950003', nama: 'Agus Wijaya', ttl: '1995-01-01', alamat: 'Jl. Diponegoro No. 5, Bandung', registrasi_at: new Date().toISOString() },
                    '3501012010000004': { nik: '3501012010000004', nama: 'Dewi Anggraini', ttl: '2000-10-20', alamat: 'Jl. Gajah Mada No. 15, Medan', registrasi_at: new Date().toISOString() },
                    '3501010505980005': { nik: '3501010505980005', nama: 'Eka Putra', ttl: '1998-05-05', alamat: 'Jl. Sudirman No. 30, Semarang', registrasi_at: new Date().toISOString() },
                    '3501011011920006': { nik: '3501011011920006', nama: 'Fajar Nugroho', ttl: '1992-11-10', alamat: 'Jl. A. Yani No. 7, Yogyakarta', registrasi_at: new Date().toISOString() },
                    '3501012504850007': { nik: '3501012504850007', nama: 'Gita Permata', ttl: '1985-04-25', alamat: 'Jl. Imam Bonjol No. 12, Makassar', registrasi_at: new Date().toISOString() },
                    '3501011809990008': { nik: '3501011809990008', nama: 'Hadi Prasetyo', ttl: '1999-09-18', alamat: 'Jl. Teuku Umar No. 8, Palembang', registrasi_at: new Date().toISOString() },
                    '3501010302010009': { nik: '3501010302010009', nama: 'Indah Cahyani', ttl: '2001-02-03', alamat: 'Jl. Pattimura No. 19, Denpasar', registrasi_at: new Date().toISOString() },
                    '3501011408930010': { nik: '3501011408930010', nama: 'Joko Susilo', ttl: '1993-08-14', alamat: 'Jl. Hasanuddin No. 22, Banjarmasin', registrasi_at: new Date().toISOString() },
                    '3501013012970011': { nik: '3501013012970011', nama: 'Kania Dewi', ttl: '1997-12-30', alamat: 'Jl. Sisingamangaraja No. 3, Balikpapan', registrasi_at: new Date().toISOString() }
                };
                savePasienDb(dummies);
            }

            // ===== FUNGSI UTAMA ADMIN =====
            
            function sortData() {
                const { sortKey, sortDir } = adminState;
                const sorted = [...adminState.dataFull].sort((a, b) => {
                    if (a[sortKey] < b[sortKey]) return sortDir === 'asc' ? -1 : 1;
                    if (a[sortKey] > b[sortKey]) return sortDir === 'asc' ? 1 : -1;
                    return 0;
                });
                adminState.dataSorted = sorted;
            }
            
            function paginateData() {
                const { currentPage, rowsPerPage, dataSorted } = adminState;
                const totalData = dataSorted.length;
                const totalPages = Math.ceil(totalData / rowsPerPage);
                adminState.currentPage = Math.max(1, Math.min(currentPage, totalPages)); // Pastikan halaman valid
                
                const start = (adminState.currentPage - 1) * rowsPerPage;
                const end = start + parseInt(rowsPerPage, 10);
                adminState.dataPaginated = dataSorted.slice(start, end);
                
                // Update UI Paginasi
                const startData = totalData > 0 ? start + 1 : 0;
                const endData = Math.min(end, totalData);
                pageInfo.textContent = `Menampilkan ${startData}-${endData} dari ${totalData} data`;
                pageNumber.textContent = `Halaman ${adminState.currentPage} / ${totalPages > 0 ? totalPages : 1}`;
                prevPageBtn.disabled = adminState.currentPage === 1;
                nextPageBtn.disabled = adminState.currentPage === totalPages || totalPages === 0;
            }
            
            function renderTabel() {
                tabelPasienBody.innerHTML = ""; // Kosongkan tabel
                if (adminState.dataPaginated.length === 0) {
                    tabelPasienBody.innerHTML = `<tr class="border-b"><td colspan="5" class="py-6 px-4 text-center text-gray-500">Tidak ada data pasien...</td></tr>`;
                    return;
                }
                
                adminState.dataPaginated.forEach(pasien => {
                    const row = `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="py-3 px-4 font-mono text-gray-700">${pasien.nik}</td>
                            <td class="py-3 px-4 font-medium text-gray-900">${pasien.nama}</td>
                            <td class="py-3 px-4 text-gray-700">${pasien.ttl}</td>
                            <td class="py-3 px-4 text-gray-700">${pasien.alamat}</td>
                            <td class="py-3 px-4 text-sm font-medium space-x-2">
                                <button data-nik="${pasien.nik}" class="btn-edit text-yellow-600 hover:text-yellow-800">Ubah</button>
                                <button data-nik="${pasien.nik}" class="btn-hapus text-red-600 hover:text-red-800">Hapus</button>
                            </td>
                        </tr>
                    `;
                    tabelPasienBody.innerHTML += row;
                });
            }

            function tampilkanDataLengkap() {
                // 1. Tampilkan Total Pasien & Antrian
                const pasienDb = getPasienDb();
                adminState.dataFull = Object.values(pasienDb);
                const jumlahPasien = adminState.dataFull.length;
                totalPasien.textContent = jumlahPasien;

                const antrianDb = getAntrianDb();
                antrianUmum.textContent = antrianDb["Poli Umum"] || 1;
                antrianGigi.textContent = antrianDb["Poli Gigi"] || 1;
                antrianIgd.textContent = antrianDb["IGD"] || 1;
                
                // 2. Sortir, Paginasi, dan Render Tabel
                sortData();
                paginateData();
                renderTabel();
                
                // 3. Update Status Header Sortir
                sortHeaders.forEach(header => {
                    const key = header.dataset.sort;
                    const icon = header.querySelector('.sort-icon');
                    if (key === adminState.sortKey) {
                        header.classList.add('active', 'text-primary-600');
                        icon.innerHTML = adminState.sortDir === 'asc' ? '&darr;' : '&uarr;';
                    } else {
                        header.classList.remove('active', 'text-primary-600');
                        icon.innerHTML = '&uarr;&darr;';
                    }
                });
            }

            function login(username, password) {
                if (username === 'admin' && password === 'admin123') {
                    localStorage.setItem(ADMIN_AUTH_KEY, 'true');
                    pageLogin.classList.add('hidden');
                    pageDashboard.classList.remove('hidden');
                    document.getElementById('admin-nama').textContent = username;
                    createDummyData(); // Buat data dummy jika DB kosong
                    tampilkanDataLengkap();
                } else {
                    loginError.classList.remove('hidden');
                }
            }

            function logout() {
                localStorage.removeItem(ADMIN_AUTH_KEY);
                pageLogin.classList.remove('hidden');
                pageDashboard.classList.add('hidden');
            }
            
            function showModal(modal) { modal.classList.remove('hidden'); }
            function hideModal(modal) { modal.classList.add('hidden'); }

            // ===== EVENT LISTENERS =====

            formLogin.addEventListener('submit', (e) => {
                e.preventDefault();
                login(inputAdminUser.value, inputAdminPass.value);
            });

            btnLogout.addEventListener('click', logout);
            
            // Kontrol Tabel
            sortHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    const key = header.dataset.sort;
                    if (adminState.sortKey === key) {
                        adminState.sortDir = adminState.sortDir === 'asc' ? 'desc' : 'asc';
                    } else {
                        adminState.sortKey = key;
                        adminState.sortDir = 'asc';
                    }
                    adminState.currentPage = 1; // Reset ke halaman 1
                    tampilkanDataLengkap();
                });
            });
            
            showRowsSelect.addEventListener('change', (e) => {
                adminState.rowsPerPage = parseInt(e.target.value, 10);
                adminState.currentPage = 1;
                tampilkanDataLengkap();
            });
            
            prevPageBtn.addEventListener('click', () => {
                if (adminState.currentPage > 1) {
                    adminState.currentPage--;
                    tampilkanDataLengkap();
                }
            });
            
            nextPageBtn.addEventListener('click', () => {
                const totalData = adminState.dataSorted.length;
                const totalPages = Math.ceil(totalData / adminState.rowsPerPage);
                if (adminState.currentPage < totalPages) {
                    adminState.currentPage++;
                    tampilkanDataLengkap();
                }
            });

            // Event listener untuk tombol "Ubah" (Antrian) dan "Reset"
            document.body.addEventListener('click', (e) => {
                const target = e.target;
                
                // Tombol "Ubah" Antrian
                if (target.classList.contains('btn-ubah')) {
                    const poli = target.dataset.poli;
                    const antrianDb = getAntrianDb();
                    const nomorLama = antrianDb[poli] || 1;
                    const nomorBaru = prompt(`Masukkan nomor antrian baru untuk ${poli}:`, nomorLama);
                    if (nomorBaru && !isNaN(nomorBaru) && nomorBaru > 0) {
                        if (confirm(`Anda yakin ingin mengubah antrian ${poli} dari ${nomorLama} menjadi ${nomorBaru}?`)) {
                            antrianDb[poli] = parseInt(nomorBaru, 10);
                            saveAntrianDb(antrianDb);
                            tampilkanDataLengkap();
                        }
                    } else if (nomorBaru !== null) { // Jika user input tapi tidak valid
                        alert("Input tidak valid. Harap masukkan angka lebih dari 0.");
                    }
                }
                
                // Tombol "Reset" Antrian
                if (target.classList.contains('btn-reset')) {
                    const poli = target.dataset.poli;
                    if (confirm(`Anda yakin ingin mereset antrian ${poli} kembali ke 1?`)) {
                        const antrianDb = getAntrianDb();
                        antrianDb[poli] = 1;
                        saveAntrianDb(antrianDb);
                        tampilkanDataLengkap();
                    }
                }
                
                // Tombol "Retrain" (Simulasi)
                if (target.id === 'btn-retrain') {
                    alert("Simulasi: Model AI sedang dilatih ulang dengan data pasien terbaru...");
                }
            });
            
            // Event Delegation untuk tombol Hapus dan Edit di tabel
            tabelPasienBody.addEventListener('click', (e) => {
                const target = e.target;
                
                // Tombol Hapus
                if (target.classList.contains('btn-hapus')) {
                    const nik = target.dataset.nik;
                    const pasien = getPasienDb()[nik];
                    konfirmasiPesan.textContent = `Anda yakin ingin menghapus data pasien: ${pasien.nama} (NIK: ${nik})?`;
                    adminState.nikUntukDihapus = nik; // Simpan NIK untuk dihapus
                    showModal(modalKonfirmasi);
                }
                
                // Tombol Edit
                if (target.classList.contains('btn-edit')) {
                    const nik = target.dataset.nik;
                    const pasien = getPasienDb()[nik];
                    if (pasien) {
                        adminState.nikUntukDiedit = nik; // Simpan NIK lama
                        document.getElementById('edit-nik-lama').value = nik;
                        document.getElementById('edit-nik').value = pasien.nik;
                        document.getElementById('edit-nama').value = pasien.nama;
                        document.getElementById('edit-ttl').value = pasien.ttl;
                        document.getElementById('edit-alamat').value = pasien.alamat;
                        showModal(modalEditPasien);
                    }
                }
            });
            
            // Tombol di Modal Konfirmasi Hapus
            btnKonfirmasiYa.addEventListener('click', () => {
                if (adminState.nikUntukDihapus) {
                    const db = getPasienDb();
                    delete db[adminState.nikUntukDihapus];
                    savePasienDb(db);
                    adminState.nikUntukDihapus = null;
                    hideModal(modalKonfirmasi);
                    tampilkanDataLengkap(); // Refresh tabel
                }
            });
            btnKonfirmasiBatal.addEventListener('click', () => {
                adminState.nikUntukDihapus = null;
                hideModal(modalKonfirmasi);
            });
            
            // Tombol di Modal Edit Pasien
            formEditPasien.addEventListener('submit', (e) => {
                e.preventDefault();
                const nikLama = document.getElementById('edit-nik-lama').value;
                const nikBaru = document.getElementById('edit-nik').value;
                const dataBaru = {
                    nik: nikBaru,
                    nama: document.getElementById('edit-nama').value,
                    ttl: document.getElementById('edit-ttl').value,
                    alamat: document.getElementById('edit-alamat').value,
                    // Pertahankan data registrasi asli jika ada
                    registrasi_at: getPasienDb()[nikLama]?.registrasi_at || new Date().toISOString()
                };
                
                const db = getPasienDb();
                if (nikLama !== nikBaru) {
                    // Jika NIK diubah, hapus data lama
                    delete db[nikLama];
                }
                db[nikBaru] = dataBaru; // Simpan data baru (atau timpa data lama jika NIK sama)
                savePasienDb(db);
                
                hideModal(modalEditPasien);
                tampilkanDataLengkap();
            });
            btnEditBatal.addEventListener('click', () => hideModal(modalEditPasien));


            // Cek status login saat halaman dimuat
            if (localStorage.getItem(ADMIN_AUTH_KEY) === 'true') {
                pageLogin.classList.add('hidden');
                pageDashboard.classList.remove('hidden');
                createDummyData(); // Buat data dummy jika DB kosong
                tampilkanDataLengkap();
            } else {
                pageLogin.classList.remove('hidden');
                pageDashboard.classList.add('hidden');
            }
        });
    </script>
</body>
</html>